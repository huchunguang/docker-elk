
input {
    file {
        path => "/usr/share/logstash/data/movies.csv"
            start_position => "beginning"
            sincedb_path => "/dev/null"
    }
}
filter {
    csv {
        separator => ","
            columns => ["id","content","genre"]
    }

    mutate {
        split => { "genre" => "|" }
        remove_field => ["path", "host","@timestamp","message"]
    }

    mutate {

        split => ["content", "("]
            add_field => { "title" => "%{[content][0]}"}
        add_field => { "year" => "%{[content][1]}"}
    }

    mutate {
        convert => {
            "year" => "integer"
        }
        strip => ["title"]
            remove_field => ["path", "host","@timestamp","message","content"]
    }

}
output {
    elasticsearch {
        hosts => "elasticsearch:9200"
            user => "elastic"
            password => "cXyQYHsKVOfuD9AHiTTi"
            index => "movies"
     document_id => "%{id}"
    }
    stdout {}
}
